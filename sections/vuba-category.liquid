{% schema %}
{
  "name": "Dynamic Project Filters",
  "settings": [],
  "blocks": [],
  "presets": [
    {
      "name": "Dynamic Filters"
    }
  ]
}
{% endschema %}

<section class="filters-section flex flex-wrap">
  <!-- Sidebar: Dynamic Filters -->
  <aside class="w-full md:w-1/4 gap-y-10 flex flex-wrap flex-col">
    {% for filter in shop.metaobjects.project_filters.values %}
      <div class="col">
        <h3 class="text-2xl 3xl:text-4xl font-semibold border-b-2 border-[#707070] pb-5 mb-7">
          {{ filter.filter_title }}
        </h3>
        <div class="flex flex-wrap gap-2 items-end">
          {% for option in filter.filter_options %}
            <button
              class="filter-btn"
              data-filter-type="{{ filter.filter_title | handleize }}"
              data-filter-value="{{ option | handle }}"
            >
              {{ option }}
            </button>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <button id="clear-filters" class="btn btn-secondary mt-4">Clear Filters</button>
  </aside>

  <!-- Main Content: Project Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 w-full md:w-[75%]">
    {% for product in collections.all.products %}
      <div
        class="project-item bg-white rounded-2xl overflow-hidden relative"
        data-color="{{ product.metafields.custom.color | handle }}"
        data-job="{{ product.metafields.custom.job | handle }}"
      >
        {% if product.featured_image %}
          <img src="{{ product.featured_image | img_url: '600x600' }}" class="w-full aspect-square object-cover h-full">
        {% else %}
          <img src="https://via.placeholder.com/600" class="w-full aspect-square object-cover h-full">
        {% endif %}

        <div class="absolute top-0 left-0 w-full h-full p-4 xl:p-3 2xl:p-4 flex flex-wrap items-end justify-end">
          <div class="btn-wrap flex flex-wrap gap-2 justify-end">
            {% if product.metafields.custom.color %}
              <span class="filter-tag">{{ product.metafields.custom.color }}</span>
            {% endif %}
            {% if product.metafields.custom.job %}
              <span class="filter-tag">{{ product.metafields.custom.job }}</span>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<!-- JavaScript for Filtering -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
      const filterButtons = document.querySelectorAll(".filter-btn");
      const projects = document.querySelectorAll(".project-item");
      let activeFilters = { color: [], job: [] };

      function filterProjects() {
          projects.forEach((project) => {
              const projectColor = project.dataset.color;
              const projectJob = project.dataset.job;

              const colorMatch = activeFilters.color.length === 0 || activeFilters.color.includes(projectColor);
              const jobMatch = activeFilters.job.length === 0 || activeFilters.job.includes(projectJob);

              if (colorMatch && jobMatch) {
                  project.style.display = "block";
              } else {
                  project.style.display = "none";
              }
          });
      }

      filterButtons.forEach((button) => {
          button.addEventListener("click", function () {
              const filterType = this.dataset.filterType;
              const filterValue = this.dataset.filterValue;

              if (activeFilters[filterType].includes(filterValue)) {
                  activeFilters[filterType] = activeFilters[filterType].filter((val) => val !== filterValue);
                  this.classList.remove("active");
              } else {
                  activeFilters[filterType].push(filterValue);
                  this.classList.add("active");
              }

              filterProjects();
          });
      });

      document.getElementById("clear-filters").addEventListener("click", function () {
          activeFilters = { color: [], job: [] };
          document.querySelectorAll(".filter-btn").forEach(btn => btn.classList.remove("active"));
          filterProjects();
      });
  });
</script>

<style>
  .filter-btn {
    background: #f4f4f4;
    border: 1px solid #ccc;
    padding: 10px 15px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn.active {
    background: #000;
    color: #fff;
  }

  .project-item {
    transition: all 0.3s ease;
  }

  .filter-tag {
    background: rgba(0, 0, 0, 0.1);
    padding: 5px 10px;
    border-radius: 5px;
  }
</style>
